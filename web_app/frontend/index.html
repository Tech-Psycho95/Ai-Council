<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Council - Multi-Agent Orchestration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }
        .markdown-content {
            line-height: 1.7;
            color: #1f2937;
        }
        .markdown-content h1 { font-size: 1.5em; font-weight: bold; margin: 1em 0 0.5em; color: #111827; }
        .markdown-content h2 { font-size: 1.3em; font-weight: bold; margin: 1em 0 0.5em; color: #1f2937; }
        .markdown-content h3 { font-size: 1.1em; font-weight: bold; margin: 1em 0 0.5em; color: #374151; }
        .markdown-content p { margin: 0.75em 0; }
        .markdown-content ul, .markdown-content ol { margin: 0.75em 0; padding-left: 2em; }
        .markdown-content li { margin: 0.25em 0; }
        .markdown-content code { 
            background: #f3f4f6; 
            padding: 0.2em 0.4em; 
            border-radius: 3px; 
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #dc2626;
        }
        .markdown-content pre { 
            background: #1f2937; 
            color: #f3f4f6; 
            padding: 1em; 
            border-radius: 0.5em; 
            overflow-x: auto; 
            margin: 1em 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .markdown-content pre code { 
            background: transparent; 
            padding: 0;
            color: #f3f4f6;
        }
        .markdown-content blockquote {
            border-left: 4px solid #3b82f6;
            padding-left: 1em;
            margin: 1em 0;
            color: #4b5563;
            font-style: italic;
        }
        .markdown-content a {
            color: #3b82f6;
            text-decoration: underline;
        }
        .markdown-content strong {
            font-weight: 600;
            color: #111827;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="min-h-screen">
            <!-- Header -->
            <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
                <div class="container mx-auto px-4 py-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-brain text-3xl"></i>
                            <div>
                                <h1 class="text-3xl font-bold">AI Council</h1>
                                <p class="text-blue-100 text-sm">Multi-Agent Orchestration System</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-sm text-blue-100">System Status</div>
                                <div class="flex items-center space-x-2">
                                    <span :class="systemStatus === 'operational' ? 'bg-green-400' : 'bg-red-400'" 
                                          class="w-2 h-2 rounded-full"></span>
                                    <span class="font-semibold">{{ systemStatus }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="container mx-auto px-4 py-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Sidebar - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Execution Mode -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center">
                                <i class="fas fa-sliders-h mr-2 text-blue-600"></i>
                                Execution Mode
                            </h2>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition"
                                       :class="mode === 'fast' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                                    <input type="radio" v-model="mode" value="fast" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-semibold">Fast</div>
                                        <div class="text-xs text-gray-600">Optimized for speed</div>
                                    </div>
                                    <i class="fas fa-bolt text-yellow-500"></i>
                                </label>
                                
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition"
                                       :class="mode === 'balanced' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                                    <input type="radio" v-model="mode" value="balanced" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-semibold">Balanced</div>
                                        <div class="text-xs text-gray-600">Speed & quality balance</div>
                                    </div>
                                    <i class="fas fa-balance-scale text-blue-500"></i>
                                </label>
                                
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition"
                                       :class="mode === 'best_quality' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                                    <input type="radio" v-model="mode" value="best_quality" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-semibold">Best Quality</div>
                                        <div class="text-xs text-gray-600">Maximum quality</div>
                                    </div>
                                    <i class="fas fa-star text-purple-500"></i>
                                </label>
                            </div>
                        </div>

                        <!-- System Info -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                                System Info
                            </h2>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Available Models:</span>
                                    <span class="font-semibold">{{ availableModels }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Requests:</span>
                                    <span class="font-semibold">{{ totalRequests }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Cost:</span>
                                    <span class="font-semibold">${{ totalCost.toFixed(4) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center">
                                <i class="fas fa-rocket mr-2 text-blue-600"></i>
                                Quick Actions
                            </h2>
                            <div class="space-y-2">
                                <button @click="showTradeoffAnalysis" 
                                        class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm">
                                    <i class="fas fa-chart-line mr-2"></i>Analyze Trade-offs
                                </button>
                                <button @click="estimateCost" 
                                        class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm">
                                    <i class="fas fa-calculator mr-2"></i>Estimate Cost
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Chat Area -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Chat Messages -->
                        <div class="bg-white rounded-lg shadow-md flex flex-col" style="height: calc(100vh - 200px); min-height: 600px;">
                            <div class="p-6 border-b">
                                <h2 class="text-xl font-bold flex items-center">
                                    <i class="fas fa-comments mr-2 text-blue-600"></i>
                                    Conversation
                                    <button @click="clearChat" class="ml-auto text-sm text-gray-500 hover:text-red-600 transition">
                                        <i class="fas fa-trash mr-1"></i>Clear
                                    </button>
                                </h2>
                            </div>
                            
                            <!-- Messages Container -->
                            <div ref="messagesContainer" class="flex-1 overflow-y-auto p-6 space-y-4" style="scroll-behavior: smooth;">
                                <div v-if="messages.length === 0" class="text-center text-gray-400 py-12">
                                    <i class="fas fa-comment-dots text-6xl mb-4"></i>
                                    <p class="text-lg">Start a conversation with AI Council</p>
                                    <p class="text-sm mt-2">Powered by Google Gemini 2.5 Flash</p>
                                </div>
                                
                                <div v-for="(message, index) in messages" :key="index" 
                                     class="flex animate-fade-in" :class="message.role === 'user' ? 'justify-end' : 'justify-start'">
                                    <div class="max-w-[85%] rounded-lg p-4 shadow-md" 
                                         :class="message.role === 'user' ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white' : 'bg-gradient-to-r from-gray-50 to-gray-100'">
                                        <div class="flex items-center mb-2">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center mr-2"
                                                 :class="message.role === 'user' ? 'bg-blue-500' : 'bg-purple-500'">
                                                <i :class="message.role === 'user' ? 'fa-user' : 'fa-robot'" 
                                                   class="fas text-white text-sm"></i>
                                            </div>
                                            <span class="font-semibold">{{ message.role === 'user' ? 'You' : 'AI Council' }}</span>
                                            <span class="ml-auto text-xs opacity-75">{{ message.timestamp }}</span>
                                        </div>
                                        <div v-if="message.role === 'assistant'" 
                                             class="markdown-content prose prose-sm max-w-none" 
                                             v-html="renderMarkdown(message.content)"></div>
                                        <div v-else class="whitespace-pre-wrap">{{ message.content }}</div>
                                        
                                        <!-- Metadata for assistant messages -->
                                        <div v-if="message.role === 'assistant' && message.metadata" 
                                             class="mt-3 pt-3 border-t border-gray-300 text-xs space-y-1">
                                            <div class="grid grid-cols-2 gap-2">
                                                <div class="flex items-center">
                                                    <i class="fas fa-clock mr-1 text-blue-600"></i>
                                                    <span>{{ message.metadata.execution_time }}s</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <i class="fas fa-dollar-sign mr-1 text-green-600"></i>
                                                    <span>${{ message.metadata.cost }}</span>
                                                </div>
                                                <div class="flex items-center col-span-2">
                                                    <i class="fas fa-brain mr-1 text-purple-600"></i>
                                                    <span>{{ message.metadata.models_used.join(', ') }}</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <i class="fas fa-chart-line mr-1 text-orange-600"></i>
                                                    <span>{{ (message.metadata.confidence * 100).toFixed(0) }}% confidence</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Loading indicator -->
                                <div v-if="isProcessing" class="flex justify-start animate-fade-in">
                                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 shadow-md">
                                        <div class="flex items-center space-x-3">
                                            <div class="pulse-slow">
                                                <i class="fas fa-robot text-blue-600 text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="font-semibold text-gray-700">AI Council is thinking...</div>
                                                <div class="text-xs text-gray-500">Processing with {{ mode }} mode</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Input Area -->
                            <div class="border-t bg-gray-50 p-4">
                                <div class="flex space-x-2">
                                    <textarea v-model="query" 
                                              @keydown.enter.ctrl="processQuery"
                                              @keydown.enter.exact.prevent="processQuery"
                                              placeholder="Ask AI Council anything... (Enter to send, Shift+Enter for new line)"
                                              class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                              rows="2"></textarea>
                                    <button @click="processQuery" 
                                            :disabled="isProcessing || !query.trim()"
                                            class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed shadow-md">
                                        <i class="fas fa-paper-plane text-lg"></i>
                                    </button>
                                </div>
                                <div class="mt-2 text-xs text-gray-500 flex items-center justify-between">
                                    <span><i class="fas fa-info-circle mr-1"></i>Enter to send, Shift+Enter for new line</span>
                                    <span>{{ query.length }} characters</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Trade-off Analysis Modal -->
            <div v-if="showAnalysis" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">Cost-Quality Trade-off Analysis</h2>
                            <button @click="showAnalysis = false" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div v-if="analysisData" class="space-y-6">
                            <!-- Mode Comparison -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div v-for="(data, mode) in getModeData(analysisData)" :key="mode" 
                                     class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-200">
                                    <h3 class="font-bold text-lg mb-3 capitalize">{{ mode.replace('_', ' ') }}</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Cost:</span>
                                            <span class="font-semibold">${{ data.total_cost.toFixed(4) }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Time:</span>
                                            <span class="font-semibold">{{ data.total_time.toFixed(1) }}s</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Quality:</span>
                                            <span class="font-semibold">{{ (data.average_quality * 100).toFixed(0) }}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Value:</span>
                                            <span class="font-semibold">{{ data.trade_off_score.toFixed(2) }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recommendations -->
                            <div v-if="analysisData.recommendations" class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <h3 class="font-bold text-lg mb-3 flex items-center">
                                    <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                    Recommendations
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    <div v-for="(rec, key) in analysisData.recommendations" :key="key">
                                        <span class="text-gray-600 capitalize">{{ key.replace('_', ' ') }}:</span>
                                        <span class="font-semibold ml-2">{{ rec }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div v-else class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                            <p class="text-gray-600">Analyzing trade-offs...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    query: '',
                    mode: 'balanced',
                    messages: [],
                    isProcessing: false,
                    systemStatus: 'checking...',
                    availableModels: 0,
                    totalRequests: 0,
                    totalCost: 0,
                    showAnalysis: false,
                    analysisData: null,
                    apiUrl: 'http://localhost:8000'
                };
            },
            mounted() {
                this.checkSystemStatus();
            },
            methods: {
                async checkSystemStatus() {
                    try {
                        const response = await fetch(`${this.apiUrl}/api/status`);
                        const data = await response.json();
                        this.systemStatus = data.status || 'unknown';
                        this.availableModels = data.available_models?.length || 0;
                    } catch (error) {
                        this.systemStatus = 'offline';
                        console.error('Failed to check system status:', error);
                    }
                },
                async processQuery() {
                    if (!this.query.trim() || this.isProcessing) return;

                    const userMessage = {
                        role: 'user',
                        content: this.query,
                        timestamp: new Date().toLocaleTimeString()
                    };
                    this.messages.push(userMessage);

                    const currentQuery = this.query;
                    this.query = '';
                    this.isProcessing = true;

                    try {
                        const response = await fetch(`${this.apiUrl}/api/process`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                query: currentQuery,
                                mode: this.mode
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.messages.push({
                                role: 'assistant',
                                content: data.content,
                                timestamp: new Date().toLocaleTimeString(),
                                metadata: {
                                    confidence: data.confidence,
                                    models_used: data.models_used,
                                    execution_time: data.execution_time.toFixed(2),
                                    cost: data.cost.toFixed(6)
                                }
                            });

                            this.totalRequests++;
                            this.totalCost += data.cost;
                        } else {
                            this.messages.push({
                                role: 'assistant',
                                content: `Error: ${data.error_message || 'Failed to process request'}`,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    } catch (error) {
                        this.messages.push({
                            role: 'assistant',
                            content: `Error: ${error.message}`,
                            timestamp: new Date().toLocaleTimeString()
                        });
                    } finally {
                        this.isProcessing = false;
                        this.$nextTick(() => {
                            this.scrollToBottom();
                        });
                    }
                },
                clearChat() {
                    if (confirm('Clear all messages?')) {
                        this.messages = [];
                        this.totalRequests = 0;
                        this.totalCost = 0;
                    }
                },
                async showTradeoffAnalysis() {
                    if (!this.query.trim()) {
                        alert('Please enter a query first');
                        return;
                    }

                    this.showAnalysis = true;
                    this.analysisData = null;

                    try {
                        const response = await fetch(`${this.apiUrl}/api/analyze`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                query: this.query
                            })
                        });

                        this.analysisData = await response.json();
                    } catch (error) {
                        alert('Failed to analyze trade-offs: ' + error.message);
                        this.showAnalysis = false;
                    }
                },
                async estimateCost() {
                    if (!this.query.trim()) {
                        alert('Please enter a query first');
                        return;
                    }

                    try {
                        const response = await fetch(`${this.apiUrl}/api/estimate`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                query: this.query,
                                mode: this.mode
                            })
                        });

                        const data = await response.json();
                        alert(`Estimated Cost: $${data.estimated_cost.toFixed(4)}\nEstimated Time: ${data.estimated_time.toFixed(1)}s\nConfidence: ${(data.confidence * 100).toFixed(0)}%`);
                    } catch (error) {
                        alert('Failed to estimate cost: ' + error.message);
                    }
                },
                getModeData(data) {
                    const modes = {};
                    for (const key in data) {
                        if (key !== 'recommendations' && key !== 'error') {
                            modes[key] = data[key];
                        }
                    }
                    return modes;
                },
                renderMarkdown(text) {
                    return marked.parse(text);
                },
                scrollToBottom() {
                    const container = this.$refs.messagesContainer;
                    if (container) {
                        container.scrollTop = container.scrollHeight;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
